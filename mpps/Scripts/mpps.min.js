$(function () { if (window.addEventListener) { window.addEventListener("message", mpps.processMessage, false) } else { if (window.attachEvent) { window.attachEvent("onmessage", mpps.processMessage, false) } } }); mpps = {}; mpps.rootUrl = "https://mpps.azurewebsites.net/"; mpps.sucess = {}; mpps.error = {}; mpps.processMessage = function (a) { if (typeof (mpps.success) == "function") { mpps.success(a.data) } }; mpps.buildPaymentForm = function (a) { $(a).append('<div class="mpps-input-group"><label class="mpps-label mpps-label-card-type">Type:</label><input type="text" class="mpps-input mpps-input-card-type" data-mpps="card_type"></div>'); $(a).append('<div class="mpps-input-group"><label class="mpps-label mpps-label-card-number">Number:</label><input type="text" class="mpps-input mpps-input-card-number" data-mpps="card_number" /></div>'); $(a).append('<div class="mpps-input-group"><label class="mpps-label mpps-label-card-expiry-date">Expiration date:</label><input type="text" class="mpps-input mpps-input-card-expiry-date" data-mpps="card_expiry_date" /></div>'); $(a).append('<div class="mpps-input-group"><label class="mpps-label mpps-label-card-cvn">CVN:</label><input type="text" class="mpps-input mpps-input-card-cvn" data-mpps="card_cvn" /></div>'); $("input[data-mpps='card_type']").val("001"); $("input[data-mpps='card_number']").val("4242424242424242"); $("input[data-mpps='card_expiry_date']").val("11-2020"); $("input[data-mpps='card_cvn']").val("120") }; mpps.ISODateString = function (b) { function a(c) { return c < 10 ? "0" + c : c } return b.getUTCFullYear() + "-" + a(b.getUTCMonth() + 1) + "-" + a(b.getUTCDate()) + "T" + a(b.getUTCHours()) + ":" + a(b.getUTCMinutes()) + ":" + a(b.getUTCSeconds()) + "Z" }; mpps.checkout = function (b, d, a) { mpps.success = d; mpps.error = a; var c = { access_key: "2133ed425ed43e63aa8b4fdd6e8ad28a", profile_id: "LNECOM1", override_custom_receipt_page: mpps.rootUrl + "/receipt.aspx", transaction_uuid: new Date().getTime(), signed_field_names: "access_key,profile_id,transaction_uuid,signed_field_names,unsigned_field_names,signed_date_time,locale,transaction_type,reference_number,amount,currency,payment_method,bill_to_forename,bill_to_surname,bill_to_email,bill_to_phone,bill_to_address_line1,bill_to_address_city,bill_to_address_state,bill_to_address_country,bill_to_address_postal_code,override_custom_receipt_page", unsigned_field_names: "card_type,card_number,card_expiry_date,card_cvn", signed_date_time: mpps.ISODateString(new Date()), locale: "en", transaction_type: "sale,create_payment_token", reference_number: "1401217422318", currency: "USD", payment_method: "card", bill_to_forename: b.contactInfo.firstName, bill_to_surname: b.contactInfo.lastName, bill_to_address_city: b.contactInfo.city, bill_to_address_country: b.contactInfo.country, bill_to_address_line1: b.contactInfo.addressLine1, bill_to_address_state: b.contactInfo.state, bill_to_address_postal_code: b.contactInfo.postalCode, bill_to_email: b.contactInfo.email, bill_to_phone: b.contactInfo.phone, amount: b.amount }; $.ajax({ type: "POST", url: mpps.rootUrl + "/api/Signing/", contentType: "application/json", data: JSON.stringify(c), success: function (f) { c.signature = f.signature; mpps.buildCheckoutForm(c) }, error: function (g, f, e) { if (typeof (mpps.error) == "function") { mpps.error(f, e) } } }) }; mpps.buildCheckoutForm = function (c) { var b = "https://testsecureacceptance.cybersource.com/silent/pay"; var a = $("#mpps-payment_frame"); if (a.length) { a.remove() } $("body").append('<iframe id="mpps-payment_frame" name="payment_frame" frameborder="0" style="height: 980px; width: 900px" />'); var d = $("#mpps-payment_frame")[0].contentWindow; d.document.open(); d.document.write("<html><head></head><body>"); d.document.write('<form id="mpps-checkout-form" method="post" action="' + b + '">'); d.document.write('<input type="hidden" name="access_key" value="' + c.access_key + '"  />'); d.document.write('<input type="hidden" name="profile_id" value="' + c.profile_id + '"  />'); d.document.write('<input type="hidden" name="override_custom_receipt_page" value="' + c.override_custom_receipt_page + '" />'); d.document.write('<input type="hidden" name="transaction_uuid" value="' + c.transaction_uuid + '"  />'); d.document.write('<input type="hidden" name="signed_field_names" value="' + c.signed_field_names + '" />'); d.document.write('<input type="hidden" name="unsigned_field_names" value="' + c.unsigned_field_names + '" />'); d.document.write('<input type="hidden" name="signed_date_time" value="' + c.signed_date_time + '"  />'); d.document.write('<input type="hidden" name="locale" value="' + c.locale + '" />'); d.document.write('<input type="hidden" name="transaction_type" value="' + c.transaction_type + '" />'); d.document.write('<input type="hidden" name="reference_number" value="' + c.reference_number + '"/>'); d.document.write('<input type="hidden" name="currency" value="' + c.currency + '" />'); d.document.write('<input type="hidden" name="payment_method" value="' + c.payment_method + '" />'); d.document.write('<input type="hidden" name="bill_to_forename" value="' + c.bill_to_forename + '"/>'); d.document.write('<input type="hidden" name="bill_to_surname" value="' + c.bill_to_surname + '" />'); d.document.write('<input type="hidden" name="bill_to_email" value="' + c.bill_to_email + '" />'); d.document.write('<input type="hidden" name="bill_to_phone" value="' + c.bill_to_phone + '" />'); d.document.write('<input type="hidden" name="bill_to_address_line1" value="' + c.bill_to_address_line1 + '" />'); d.document.write('<input type="hidden" name="bill_to_address_city" value="' + c.bill_to_address_city + '" />'); d.document.write('<input type="hidden" name="bill_to_address_state" value="' + c.bill_to_address_state + '" />'); d.document.write('<input type="hidden" name="bill_to_address_country" value="' + c.bill_to_address_country + '" />'); d.document.write('<input type="hidden" name="bill_to_address_postal_code"" value="' + c.bill_to_address_postal_code + '" />'); d.document.write('<input type="hidden" name="card_type" value="' + $("input[data-mpps='card_type']").val() + '" />'); d.document.write('<input type="hidden" name="card_number" value="' + $("input[data-mpps='card_number']").val() + '" />'); d.document.write('<input type="hidden" name="card_expiry_date" value="' + $("input[data-mpps='card_expiry_date']").val() + '" />'); d.document.write('<input type="hidden" name="card_cvn" value="' + $("input[data-mpps='card_cvn']").val() + '" />'); d.document.write('<input type="hidden" name="amount" value="' + c.amount + '" />'); d.document.write('<input type="hidden" name="signature" value="' + c.signature + '">'); d.document.write("</form>"); d.document.write("</body></html>"); d.document.body.onload = function () { d.document.getElementById("mpps-checkout-form").submit() }; d.document.close() }; mpps.createPaymentToken = function (b, d, a) { mpps.success = d; mpps.error = a; var c = { access_key: "2133ed425ed43e63aa8b4fdd6e8ad28a", profile_id: "LNECOM1", override_custom_receipt_page: mpps.rootUrl + "/receipt.aspx", transaction_uuid: new Date().getTime(), signed_field_names: "access_key,profile_id,transaction_uuid,signed_field_names,unsigned_field_names,signed_date_time,locale,transaction_type,reference_number,currency,payment_method,bill_to_forename,bill_to_surname,bill_to_email,bill_to_phone,bill_to_address_line1,bill_to_address_city,bill_to_address_state,bill_to_address_country,bill_to_address_postal_code,override_custom_receipt_page", unsigned_field_names: "card_type,card_number,card_expiry_date,card_cvn", signed_date_time: mpps.ISODateString(new Date()), locale: "en", transaction_type: "create_payment_token", reference_number: b.referenceNumber, currency: "USD", payment_method: "card", bill_to_forename: b.contactInfo.firstName, bill_to_surname: b.contactInfo.lastName, bill_to_address_city: b.contactInfo.city, bill_to_address_country: b.contactInfo.country, bill_to_address_line1: b.contactInfo.addressLine1, bill_to_address_state: b.contactInfo.state, bill_to_address_postal_code: b.contactInfo.postalCode, bill_to_email: b.contactInfo.email, bill_to_phone: b.contactInfo.phone }; $.ajax({ type: "POST", url: mpps.rootUrl + "/api/Signing/", contentType: "application/json", headers: { Authorization: "first value", "x-timestamp": mpps.ISODateString(new Date()) }, data: JSON.stringify(c), success: function (f) { c.signature = f.signature; mpps.buildTokenCreateForm(c) }, error: function (g, f, e) { if (typeof (mpps.error) == "function") { mpps.error(f, e) } } }) }; mpps.buildTokenCreateForm = function (c) { var b = "https://testsecureacceptance.cybersource.com/silent/token/create"; var a = $("#mpps-payment_frame"); if (a.length) { a.remove() } $("body").append('<iframe id="mpps-payment_frame" name="payment_frame" frameborder="0" style="height:0px; width:0px" />'); var d = $("#mpps-payment_frame")[0].contentWindow; d.document.open(); d.document.write("<html><head></head><body>"); d.document.write('<form id="mpps-checkout-form" method="post" action="' + b + '">'); d.document.write('<input type="hidden" name="access_key" value="' + c.access_key + '"  />'); d.document.write('<input type="hidden" name="profile_id" value="' + c.profile_id + '"  />'); d.document.write('<input type="hidden" name="override_custom_receipt_page" value="' + c.override_custom_receipt_page + '" />'); d.document.write('<input type="hidden" name="transaction_uuid" value="' + c.transaction_uuid + '"  />'); d.document.write('<input type="hidden" name="signed_field_names" value="' + c.signed_field_names + '" />'); d.document.write('<input type="hidden" name="unsigned_field_names" value="' + c.unsigned_field_names + '" />'); d.document.write('<input type="hidden" name="signed_date_time" value="' + c.signed_date_time + '"  />'); d.document.write('<input type="hidden" name="locale" value="' + c.locale + '" />'); d.document.write('<input type="hidden" name="transaction_type" value="' + c.transaction_type + '" />'); d.document.write('<input type="hidden" name="reference_number" value="' + c.reference_number + '"/>'); d.document.write('<input type="hidden" name="currency" value="' + c.currency + '" />'); d.document.write('<input type="hidden" name="payment_method" value="' + c.payment_method + '" />'); d.document.write('<input type="hidden" name="bill_to_forename" value="' + c.bill_to_forename + '"/>'); d.document.write('<input type="hidden" name="bill_to_surname" value="' + c.bill_to_surname + '" />'); d.document.write('<input type="hidden" name="bill_to_email" value="' + c.bill_to_email + '" />'); d.document.write('<input type="hidden" name="bill_to_phone" value="' + c.bill_to_phone + '" />'); d.document.write('<input type="hidden" name="bill_to_address_line1" value="' + c.bill_to_address_line1 + '" />'); d.document.write('<input type="hidden" name="bill_to_address_city" value="' + c.bill_to_address_city + '" />'); d.document.write('<input type="hidden" name="bill_to_address_state" value="' + c.bill_to_address_state + '" />'); d.document.write('<input type="hidden" name="bill_to_address_country" value="' + c.bill_to_address_country + '" />'); d.document.write('<input type="hidden" name="bill_to_address_postal_code"" value="' + c.bill_to_address_postal_code + '" />'); d.document.write('<input type="hidden" name="card_type" value="' + $("input[data-mpps='card_type']").val() + '" />'); d.document.write('<input type="hidden" name="card_number" value="' + $("input[data-mpps='card_number']").val() + '" />'); d.document.write('<input type="hidden" name="card_expiry_date" value="' + $("input[data-mpps='card_expiry_date']").val() + '" />'); d.document.write('<input type="hidden" name="card_cvn" value="' + $("input[data-mpps='card_cvn']").val() + '" />'); d.document.write('<input type="hidden" name="signature" value="' + c.signature + '">'); d.document.write("</form>"); d.document.write("</body></html>"); d.document.body.onload = function () { d.document.getElementById("mpps-checkout-form").submit() }; d.document.close() };