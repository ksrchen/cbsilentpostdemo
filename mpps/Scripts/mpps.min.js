$(function () { if (window.addEventListener) { window.addEventListener("message", mpps.processMessage, false) } else { if (window.attachEvent) { window.attachEvent("onmessage", mpps.processMessage, false) } } }); mpps = {}; mpps.rootUrl = "https://mpps.azurewebsites.net/"; mpps.sucess = {}; mpps.error = {}; mpps.processMessage = function (e) { if (typeof mpps.success == "function") { mpps.success(e.data) } }; mpps.buildPaymentForm = function (e) { var t = $("<form id='mpps-payment-form'>"); t.append('<div class="mpps-input-group"><label class="mpps-label mpps-label-card-type">Type:</label><input type="text" class="mpps-input mpps-input-card-type" name="card_type"></div>'); t.append('<div class="mpps-input-group"><label class="mpps-label mpps-label-card-number">Number:</label><input type="text" class="mpps-input mpps-input-card-number" name="card_number" /></div>'); t.append('<div class="mpps-input-group"><label class="mpps-label mpps-label-card-expiry-date">Expiration date:</label><input type="text" class="mpps-input mpps-input-card-expiry-date" name="card_expiry_date" /></div>'); t.append('<div class="mpps-input-group"><label class="mpps-label mpps-label-card-cvn">CVN:</label><input type="text" class="mpps-input mpps-input-card-cvn" name="card_cvn" /></div>'); $(e).append(t); $("input[name='card_type']").val("001"); $("input[name='card_number']").val("4242424242424242"); $("input[name='card_expiry_date']").val("11-2020"); $("input[name='card_cvn']").val("120") }; mpps.ISODateString = function (e) { function t(e) { return e < 10 ? "0" + e : e } return e.getUTCFullYear() + "-" + t(e.getUTCMonth() + 1) + "-" + t(e.getUTCDate()) + "T" + t(e.getUTCHours()) + ":" + t(e.getUTCMinutes()) + ":" + t(e.getUTCSeconds()) + "Z" }; mpps.checkout = function (e, t, n) { mpps.success = t; mpps.error = n; var r = { access_key: "2133ed425ed43e63aa8b4fdd6e8ad28a", profile_id: "LNECOM1", override_custom_receipt_page: mpps.rootUrl + "/receipt.aspx", transaction_uuid: (new Date).getTime(), signed_field_names: "access_key,profile_id,transaction_uuid,signed_field_names,unsigned_field_names,signed_date_time,locale,transaction_type,reference_number,amount,currency,payment_method,bill_to_forename,bill_to_surname,bill_to_email,bill_to_phone,bill_to_address_line1,bill_to_address_city,bill_to_address_state,bill_to_address_country,bill_to_address_postal_code,override_custom_receipt_page", unsigned_field_names: "card_type,card_number,card_expiry_date,card_cvn", signed_date_time: mpps.ISODateString(new Date), locale: "en", transaction_type: "authorization", reference_number: "1401217422318", currency: "USD", payment_method: "card", bill_to_forename: e.contactInfo.firstName, bill_to_surname: e.contactInfo.lastName, bill_to_address_city: e.contactInfo.city, bill_to_address_country: e.contactInfo.country, bill_to_address_line1: e.contactInfo.addressLine1, bill_to_address_state: e.contactInfo.state, bill_to_address_postal_code: e.contactInfo.postalCode, bill_to_email: e.contactInfo.email, bill_to_phone: e.contactInfo.phone, amount: e.amount }; $.ajax({ type: "POST", url: mpps.rootUrl + "/api/Signing/", contentType: "application/json", data: JSON.stringify(r), success: function (e) { r.signature = e.signature; mpps.buildCheckoutForm(r) }, error: function (e, t, n) { if (typeof mpps.error == "function") { mpps.error(t, n) } } }) }; mpps.buildCheckoutForm = function (e) { var t = "https://testsecureacceptance.cybersource.com/silent/pay"; var n = $("#mpps-payment_frame"); if (n.length) { n.remove() } $("body").append('<iframe id="mpps-payment_frame" name="payment_frame" frameborder="0" style="height: 980px; width: 900px" />'); var r = $("#mpps-payment_frame")[0].contentWindow; r.document.open(); r.document.write("<html><head></head><body>"); r.document.write('<form id="mpps-checkout-form" method="post" action="' + t + '">'); r.document.write('<input type="hidden" name="access_key" value="' + e.access_key + '"  />'); r.document.write('<input type="hidden" name="profile_id" value="' + e.profile_id + '"  />'); r.document.write('<input type="hidden" name="override_custom_receipt_page" value="' + e.override_custom_receipt_page + '" />'); r.document.write('<input type="hidden" name="transaction_uuid" value="' + e.transaction_uuid + '"  />'); r.document.write('<input type="hidden" name="signed_field_names" value="' + e.signed_field_names + '" />'); r.document.write('<input type="hidden" name="unsigned_field_names" value="' + e.unsigned_field_names + '" />'); r.document.write('<input type="hidden" name="signed_date_time" value="' + e.signed_date_time + '"  />'); r.document.write('<input type="hidden" name="locale" value="' + e.locale + '" />'); r.document.write('<input type="hidden" name="transaction_type" value="' + e.transaction_type + '" />'); r.document.write('<input type="hidden" name="reference_number" value="' + e.reference_number + '"/>'); r.document.write('<input type="hidden" name="currency" value="' + e.currency + '" />'); r.document.write('<input type="hidden" name="payment_method" value="' + e.payment_method + '" />'); r.document.write('<input type="hidden" name="bill_to_forename" value="' + e.bill_to_forename + '"/>'); r.document.write('<input type="hidden" name="bill_to_surname" value="' + e.bill_to_surname + '" />'); r.document.write('<input type="hidden" name="bill_to_email" value="' + e.bill_to_email + '" />'); r.document.write('<input type="hidden" name="bill_to_phone" value="' + e.bill_to_phone + '" />'); r.document.write('<input type="hidden" name="bill_to_address_line1" value="' + e.bill_to_address_line1 + '" />'); r.document.write('<input type="hidden" name="bill_to_address_city" value="' + e.bill_to_address_city + '" />'); r.document.write('<input type="hidden" name="bill_to_address_state" value="' + e.bill_to_address_state + '" />'); r.document.write('<input type="hidden" name="bill_to_address_country" value="' + e.bill_to_address_country + '" />'); r.document.write('<input type="hidden" name="bill_to_address_postal_code"" value="' + e.bill_to_address_postal_code + '" />'); r.document.write('<input type="hidden" name="card_type" value="' + $("input[name='card_type']").val() + '" />'); r.document.write('<input type="hidden" name="card_number" value="' + $("input[name='card_number']").val() + '" />'); r.document.write('<input type="hidden" name="card_expiry_date" value="' + $("input[name='card_expiry_date']").val() + '" />'); r.document.write('<input type="hidden" name="card_cvn" value="' + $("input[name='card_cvn']").val() + '" />'); r.document.write('<input type="hidden" name="amount" value="' + e.amount + '" />'); r.document.write('<input type="hidden" name="signature" value="' + e.signature + '">'); r.document.write("</form>"); r.document.write("</body></html>"); r.document.body.onload = function () { r.document.getElementById("mpps-checkout-form").submit() }; r.document.close() }